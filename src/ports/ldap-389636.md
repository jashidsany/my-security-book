# LDAP (389/636)

### Anonymous bind enum

```bash
ldapsearch -x -H ldap://$IP -b '' -s base namingContexts
```

> Find base DN

**Why:** Starting point for LDAP enum

<details>
<summary>Example Output</summary>

```
ldapsearch -x -H ldap://10.10.10.5
namingContexts: DC=corp,DC=local
(SUCCESS = anonymous LDAP access)
```
</details>

---

### Dump all objects

```bash
ldapsearch -x -H ldap://$IP -b 'DC=domain,DC=local'
```

> Full LDAP dump

**Why:** Users, groups, computers, OUs

<details>
<summary>Example Output</summary>

```
ldapsearch -x -H ldap://10.10.10.5 -b 'DC=corp,DC=local'
dn: CN=John Smith,OU=Users,DC=corp,DC=local
sAMAccountName: john.smith
description: Temp password: Welcome1
(PASSWORD IN DESCRIPTION FIELD)
```
</details>

---

### Enum users

```bash
ldapsearch -x -H ldap://$IP -b 'DC=domain,DC=local' '(objectClass=user)' sAMAccountName
```

> All AD users

**Why:** Build user list

<details>
<summary>Example Output</summary>

```
ldapsearch -x -H ldap://10.10.10.5 -b 'DC=corp,DC=local' '(objectClass=person)' sAMAccountName
dn: CN=John Smith,OU=Users,DC=corp,DC=local
sAMAccountName: john.smith

dn: CN=SVC SQL,OU=Service Accounts,DC=corp,DC=local
sAMAccountName: svc_sql
(Full user list from LDAP)
```
</details>

---

### Nmap LDAP scripts

```bash
nmap --script ldap-* -p 389 $IP
```

> Automated LDAP enum

**Why:** Quick overview

<details>
<summary>Example Output</summary>

```
nmap --script ldap-* -p 389 10.10.10.5
| ldap-rootdse:
|   namingContexts: DC=corp,DC=local
|   domainFunctionality: 7 (2016)
|_  forestFunctionality: 7
```
</details>

---

### Check for password in description

```bash
ldapsearch -x -H ldap://$IP -b 'DC=domain,DC=local' '(objectClass=user)' sAMAccountName description
```

> Users with passwords in desc field

**Why:** Lazy admins store creds here

<details>
<summary>Example Output</summary>

```
ldapsearch -x -H ldap://10.10.10.5 -b 'DC=corp,DC=local' '(description=*pass*)'
dn: CN=svc_backup,OU=Service,DC=corp,DC=local
description: Password is Backup2024!
(CLEARTEXT PASSWORD IN LDAP)
```
</details>

---
