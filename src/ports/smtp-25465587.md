# SMTP (25/465/587)

### User enumeration (VRFY)

```bash
smtp-user-enum -M VRFY -U users.txt -t $IP
```

> Verify valid usernames

**Why:** Build username list for other services

<details>
<summary>Example Output</summary>

```
smtp-user-enum -M VRFY -U users.txt -t 10.10.10.5
250 2.1.5 admin
250 2.1.5 john
550 5.1.1 <fakeuser>: Recipient not found
```
</details>

---

### User enumeration (RCPT TO)

```bash
smtp-user-enum -M RCPT -U users.txt -t $IP
```

> Alternative method

**Why:** If VRFY is disabled

<details>
<summary>Example Output</summary>

```
smtp-user-enum -M RCPT -U users.txt -t 10.10.10.5
10.10.10.5: admin exists
10.10.10.5: john exists
10.10.10.5: postmaster exists
```
</details>

---

### User enumeration (EXPN)

```bash
smtp-user-enum -M EXPN -U users.txt -t $IP
```

> Expand mailing lists

**Why:** May reveal users

<details>
<summary>Example Output</summary>

```
smtp-user-enum -M EXPN -U users.txt -t 10.10.10.5
10.10.10.5: admin <admin@corp.local>
10.10.10.5: all-staff <john@corp.local, jane@corp.local>
```
</details>

---

### Nmap SMTP scripts

```bash
nmap --script smtp-* -p 25 $IP
```

> All SMTP nmap scripts

**Why:** Enum, open relay, vulns

<details>
<summary>Example Output</summary>

```
nmap --script smtp-* -p 25 10.10.10.5
|_smtp-open-relay: Server is an open relay
| smtp-enum-users:
|   root, admin, postmaster
(OPEN RELAY = can send emails as anyone)
```
</details>

---

### Send test email

```bash
swaks --to user@domain --from test@test.com --server $IP
```

> Test for open relay

**Why:** Can send phishing emails

<details>
<summary>Example Output</summary>

```
swaks --to admin@corp.local --from ceo@corp.local --server 10.10.10.5 --body 'Test'
=== Connected to 10.10.10.5
<-  250 2.0.0 Ok: queued
(Open relay confirmed - phishing possible)
```
</details>

---
